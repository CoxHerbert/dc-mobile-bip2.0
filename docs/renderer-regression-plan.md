# 渲染器回归测试方案

本方案定义了旧/新表单渲染器并行运行期间需要覆盖的自动化与手工测试，确保兼容性与交互一致性。

## 1. 测试范围

- Workflow 发起页（`WorkflowFormStart`）
- Workflow 详情页（`WorkflowFormDetail`）内的摘要与主表单
- 依赖 schema 渲染的其他复用页面（按需补充）

## 2. 触发条件

1. URL 参数 `rendererCompare=true`
2. 测试/预发域名包含 `test`、`staging`、`preview`

## 3. 自动化用例建议

| 模块 | 用例 | 说明 |
| ---- | ---- | ---- |
| 表单基础 | schema 同步 | 启动页面后读取 `RendererComparePanel.diffEntries`，断言长度为 0。 |
| 事件一致性 | 事件匹配 | 触发常用控件（输入、选择、切换）后校验 `eventComparisons` 全部 `match=true`。 |
| API 参数 | 提交流程 | 监听 `submit` 事件 payload，确保与旧渲染器一致，再调用原有 `handleSubmit`。 |
| 辅助工具 | 重置/清空 | 调用 `resetModern`、`clearLogs` 并断言 diff 与日志归零。 |

> 自动化可通过 `@vue/test-utils` 或 Cypress 注入测试 schema，并直接访问组件实例公开方法。

## 4. 手工回归清单

1. **字段展示**：对比两侧表单字段顺序、必填标识、默认值是否一致。
2. **数据同步**：在旧渲染器依次填写常见控件（文本、单选、字典、多选、动态表格），确认新渲染器数据同步无误。
3. **事件验证**：在面板底部事件表格中，确认最新事件均为“`一致`”；若出现“`不一致`”，记录 payload 并提交缺陷。
4. **异常兜底**：刻意输入非法值（如清空必填、输入超长文本），观察两个渲染器的校验提示是否一致。
5. **草稿/提交**：执行草稿保存与正式提交流程，检查后台入参与旧逻辑一致。
6. **移动端适配**：在模拟器或真机上验证面板布局，确保不会遮挡核心操作。

## 5. 回归节奏

- 冒烟：每次对 schema、渲染器或对比面板有改动时执行。
- 周回归：联调阶段保持每周至少一次覆盖。
- 上线前：最后一轮全量手工回归 + 自动化快照。

## 6. 缺陷处理

- 在缺陷单中附带面板截图及事件日志，便于快速定位。
- 修复后重新执行“数据同步”“事件验证”两项用例，确保差异已消除。

如需扩展自动化或增补用例，请同步更新本文档，并在评审会上确认执行周期。
