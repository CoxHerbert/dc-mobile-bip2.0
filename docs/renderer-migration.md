# 渲染器迁移指南

本指南总结了旧版 `wf-form` 渲染器与新版 `dc-form-renderer` 之间的兼容策略，提供组件映射、行为差异说明与注意事项，帮助团队平滑完成迁移。

## 渲染器对照

| 旧渲染器组件 | 新渲染器组件 | 说明 |
| ------------- | ------------ | ---- |
| `wf-form` | `dc-form-renderer` | 基于同一 schema 渲染逻辑，新增事件捕获能力。 |
| `wf-form` + 对照面板 | `RendererComparePanel` | 测试环境中并行渲染旧/新表单并记录差异。 |
| `wf-ui` 工具函数 | `dc` 渲染器复用 | 继续复用 `deepClone`、`validateNull` 等工具以保证结果一致。 |

> 旧渲染器仍作为主流程组件保留，待新版验证通过后方可切换。

## 差异说明

- **渲染方式**：新版 `dc-form-renderer` 直接复用 schema，并通过 `RendererComparePanel` 的只读/编辑切换，对照旧渲染器输出，确保字段顺序与 UI 布局一致。
- **事件处理**：对常用事件（`input`、`submit`、`change`、`focus`、`blur`）建立统一拦截。事件 payload 会在面板中以表格形式展示，方便比对。
- **字典/缓存**：新组件继承了 `dc` 目录下的字典处理 mixin，但依旧调用 `wf-ui` 的基础工具函数，确保缓存 key 与取值逻辑兼容。
- **菜单按钮**：比较面板默认隐藏新渲染器底部菜单，避免重复提交；需要手动触发时可在面板开关中关闭同步后验证。

## 注意事项

1. **测试开关**：默认仅在测试域名或 URL 参数 `?rendererCompare=true` 下启用。生产环境仍走旧渲染器。
2. **数据源**：比较面板默认从旧渲染器同步数据至新渲染器，若需单独测试新渲染器，请关闭同步并使用重置按钮恢复状态。
3. **日志容量**：事件日志保留最新 10 条，必要时可使用“清除对比日志”按钮重置。
4. **样式隔离**：新组件 CSS 前缀为 `dc-form`，不会覆盖旧样式；若后续扩展，需要保持命名空间。
5. **定制字段**：表单内的定制组件（如 `wkf-` 前缀）仍由旧体系维护，新渲染器通过 schema 保持透传，无需重复注册。

## 迁移建议

- 在功能联调阶段保持对照模式，记录所有差异并在同一迭代内修复。
- 当 diff/事件日志持续为“暂无差异”且回归通过后，可移除同步限制，逐步切换默认渲染器。
- 若出现兼容问题，优先检查 schema 是否含有旧版独有属性（例如自定义 slot），必要时在 `RendererComparePanel` 中补充适配。

如需扩展，请在 PR 中同步更新本文档并告知测试人员，确保迁移节奏一致。
